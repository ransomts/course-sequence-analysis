# midfield

## Exploring the tables

```{r load-midfield-libraries-and-data, cache=TRUE, warning=FALSE, echo=FALSE, message=FALSE}
library(tidyverse)
library(magrittr)
library(midfielddata)
data(course, degree, package = "midfielddata")
```

## collection of utility functions

```{r defining-utility-functions}
did_student_graduate <- function(mcid) {
  return(degree %>% filter(mcid == mcid) %>% nrow() > 0)
}

compute_semester_indicies <- function(single_student_record) {
  single_student_record$data -> foo
  bar <- foo[[1]] %>% 
    tibble() %>% 
    mutate(term_course = as_factor(term_course)) %>% 
    mutate(semester_taken = as.integer(term_course))
  return(bar)
}

# data is the results from the 
format_courses <- function(single_student) {
  transcript_summary <- single_student$data[[1]] %>%
    group_by(term_course) %>% 
    mutate(p = str_c(abbrev, number, sep = " ")) %>%
    summarize(label = paste(p, collapse = "\n")) %>% 
    ungroup() %>% 
    select(label)
  return(transcript_summary)
}

```


## Pulling student course sequences

```{r organize-student-data, cache=TRUE}
# convert to tibble
course <- tibble(course) %>% select(mcid, abbrev, number, term_course) %>% nest_by(mcid)

single_student <- course %>% filter(mcid == "MCID3111142283")

single_student_sequence <- format_courses(single_student)
```

## Visualizing a student's course sequence

TODO: visualize a single students path to graduation

```{r}
library(visNetwork)
library(tidygraph)

make_edges <- function(single_student_sequence) {
  number_semesters <- nrow(single_student_sequence)
  return(data.frame(from = seq(number_semesters), 
                    to = append(seq(2, number_semesters), NA)))
}

make_nodes <- function(single_student_sequence) {
  number_semesters <- nrow(single_student_sequence)
  nodes <- data.frame(id = seq(number_semesters),
             shape = "box")
  return(cbind(nodes, single_student_sequence))
}

edges <- make_edges(single_student_sequence)
nodes <- make_nodes(single_student_sequence)
visNetwork(nodes, edges, height = "500px", width = "100%") %>% 
  visInteraction(navigationButtons = TRUE) %>% visEdges(arrows = 'from')
```

